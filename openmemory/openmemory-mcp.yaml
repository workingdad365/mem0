# openmemory-mcp.yaml
type: Microsoft.App/containerApps
name: openmemory-mcp
properties:
  environmentId: /subscriptions/dd0af5f8-3ec0-430f-bb4f-3c70732c41cc/resourceGroups/rg-az01-co001501-sbox-openmemory/providers/Microsoft.App/managedEnvironments/cae-openmemory-sbox-poc-11
  configuration:
    secrets:
      - name: acr-password
      - name: user-value
      - name: api-key-value
      - name: mcp-neo4j-password
    ingress:
      external: true
      allowInsecure: false
      targetPort: 8765
      transport: http
    registries:
      - server: acropenmemory.azurecr.io
        username: acropenmemory
        passwordSecretRef: acr-password
    activeRevisionsMode: single
  template:
    containers:
    - name: openmemory-mcp-api
      image: acropenmemory.azurecr.io/openmemory-mcp:061201
      env:
      - name: USER
        secretRef: user-value
      - name: API_KEY
        secretRef: api-key-value
      - name: NEO4J_PASSWORD
        secretRef: mcp-neo4j-password
      - name: MEM0_TELEMETRY
        value: "False"
      - name: QDRANT_HOST
        value: "mem0-store"
      - name: QDRANT_PORT
        value: "6333"
      - name: NEO4J_URI
        value: "bolt://neo4j:7687"
      resources:
        cpu: 0.5
        memory: 1.0Gi
      command: ["sh", "-c"]
      args: ["uvicorn main:app --host 0.0.0.0 --port 8765 --workers 1"]
    scale:
      minReplicas: 1
      maxReplicas: 1